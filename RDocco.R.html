<!DOCTYPE html>
<html><head>
  <title>RDocco.R</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <style type="text/css">
    /* This is a style file based on the Julia port of
    * [Docco](http://jashkenas.github.com/docco/) called
    * [Jocco](http://lcw.github.com/jocco/).
    */

    /*----------------- Layout and Typography ------------------------*/
    body {
      font-family: 'Palatino Linotype', 'Book Antiqua', Palatino,
                    FreeSerif, serif;
      font-size: 15px;
      line-height: 22px;
      color: #252519;
      margin: 0;
      padding: 0;
    }

    a, a:visited               { color: #261a3b; }
    p, h1, h2, h3, h4, h5, h6  { margin: 0px 0 15px 0; }
    h1                         { margin-top: 40px; }
    ul                         { margin-top: -10px; }
    #container                 { position: relative; }

    #background {
      position: fixed;
      top: 0; left: 525px; right: 0; bottom: 0;
      background: #f5f5ff;
      border-left: 1px solid #e5e5ee;
      z-index: -1;
    }

    #jump_to, #jump_page {
      background: white;
      -webkit-box-shadow: 0 0 25px #777; -moz-box-shadow: 0 0 25px #777;
      -webkit-border-bottom-left-radius: 5px; -moz-border-radius-bottomleft: 5px;
      font: 10px Arial;
      text-transform: uppercase;
      cursor: pointer;
      text-align: right;
    }

    #jump_to, #jump_wrapper {
      position: fixed;
      right: 0; top: 0;
      padding: 5px 10px;
    }

    #jump_wrapper                 { display: none; padding: 0; }
    #jump_to:hover #jump_wrapper  { display: block; }
    #jump_page                    { padding: 5px 0 3px; margin: 0 0 25px 25px; }

    #jump_page .source {
      display: block;
      padding: 5px 10px;
      text-decoration: none;
      border-top: 1px solid #eee;
    }

    #jump_page .source:hover        { background: #f5f5ff; }
    #jump_page .source:first-child  { }

    table td { border: 0; outline: 0; }
    td.docs, th.docs {
      max-width: 450px;
      min-width: 450px;
      min-height: 5px;
      padding: 10px 25px 1px 50px;
      overflow-x: hidden;
      vertical-align: top;
      text-align: left;
    }
    .docs pre { margin: 15px 0 15px; padding-left: 15px; }
    .docs p tt, .docs p code {
      background: #f8f8ff;
      border: 1px solid #dedede;
      font-size: 12px;
      padding: 0 0.2em;
    }
    .pilwrap { position: relative; }
    .pilcrow {
      font: 12px Arial;
      text-decoration: none;
      color: #454545;
      position: absolute;
      top: 3px; left: -20px;
      padding: 1px 2px;
      opacity: 0;
      -webkit-transition: opacity 0.2s linear;
    }
    td.docs:hover .pilcrow { opacity: 1; }
    td.code, th.code {
        padding: 14px 15px 16px 25px;
        width: 100%;
        vertical-align: bottom;
        background: #f5f5ff;
        border-left: 1px solid #e5e5ee;
    }
    pre, tt, code {
      font-size: 12px; line-height: 18px;
      font-family: Menlo, Monaco, Consolas, "Lucida Console", monospace;
      margin: 0; padding: 0;
    }

    /*--------------------- Syntax Highlighting ---------------------*/
    pre .number             { color: #000; }
    pre .functioncall       { color: #954121; }
    pre .string             { color: #219161; }
    pre .keyword            { font-weight: bolder; color: #000; }
    pre .argument           { color: #19469D; }
    pre .comment            { color: #2E9957; }
    pre .roxygencomment     { color: #707AB3; }
    pre .formalargs         { color: #19469D; }
    pre .eqformalargs       { color: #000; }
    pre .assignement        { font-weight: bolder; color: #000; }
    pre .package            { color: #96B525; }
    pre .slot               { font-style: italic; }
    pre .symbol             { color: #000 ;}
    pre .prompt             { color: #333 ;}
  </style>
  <script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
  <div id="container">
    <div id="background"></div>
    <table cellpadding="0" cellspacing="0">
      <thead><tr>
        <th class="docs"><h1>RDocco.R</h1></th>
        <th class="code"></th>
      </tr></thead>
      <tbody>
        <tr id="section-1">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-1">&#182;</a>
            </div>
            <h2>Introduction</h2>

          </td>
          <td class="code">
            <div class="highlight"><pre></pre></div>
          </td>
        </tr>
        <tr id="section-2">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-2">&#182;</a>
            </div>
            <p>RDocco is an R-language port of <a href="http://jashkenas.github.com/docco/">Docco</a>,
the quick-and-dirty, literate-programming-style, documentation generator. It
produces human-readable HTML that displays your comments alongside your code.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre></pre></div>
          </td>
        </tr>
        <tr id="section-3">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-3">&#182;</a>
            </div>
            <p>RDocco supports <a href="http://en.wikipedia.org/wiki/Markdown">Markdown</a>, a
lightweight markup language, for formatting of in-source comments. For
example,</p>

<ul>
<li><code>**bold**</code> is <strong>bold</strong></li>
<li><code>*emphasis*</code> is <em>emphasis</em></li>
<li><code>~~strikethrough~~</code> is <del>strikethrough</del>.</li>
<li><code>[a link](http://google.com)</code> is <a href="http://google.com">a link</a>.</li>
</ul>

          </td>
          <td class="code">
            <div class="highlight"><pre></pre></div>
          </td>
        </tr>
        <tr id="section-4">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-4">&#182;</a>
            </div>
            <p>This script also automatically formats <a href="https://github.com/yihui/roxygen2">Roxygen2</a>-style R comments, so that this function
header</p>

          </td>
          <td class="code">
            <div class="highlight"><pre></pre></div>
          </td>
        </tr>
        <tr id="section-5">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-5">&#182;</a>
            </div>
            <pre><code>#&#39; Multiply two numbers together
#&#39;
#&#39; This function calculates the product of two numbers.
#&#39; @param num_one the first factor
#&#39; @param num_two the second factor
#&#39; @return the product of the two numbers
</code></pre>

          </td>
          <td class="code">
            <div class="highlight"><pre></pre></div>
          </td>
        </tr>
        <tr id="section-6">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-6">&#182;</a>
            </div>
            <p>renders as:</p>

          </td>
          <td class="code">
            <div class="highlight"><pre></pre></div>
          </td>
        </tr>
        <tr id="section-7">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-7">&#182;</a>
            </div>
            <h3>Multiply two numbers together</h3>

<p>This function calculates the product of two numbers.</p>

<table><thead>
<tr>
<th>Parameters</th>
<th></th>
</tr>
</thead><tbody>
<tr>
<td><code>num_one</code></td>
<td>the first factor</td>
</tr>
<tr>
<td><code>num_two</code></td>
<td>the second factor</td>
</tr>
</tbody></table>

<table><thead>
<tr>
<th>Returns</th>
<th></th>
</tr>
</thead><tbody>
<tr>
<td></td>
<td>the product of the two numbers</td>
</tr>
</tbody></table>

          </td>
          <td class="code">
            <div class="highlight"><pre></pre></div>
          </td>
        </tr>
        <tr id="section-8">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-8">&#182;</a>
            </div>
            <hr>

          </td>
          <td class="code">
            <div class="highlight"><pre></pre></div>
          </td>
        </tr>
        <tr id="section-9">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-9">&#182;</a>
            </div>
            <p>This script was modeled after <a href="http://lcw.github.com/jocco/">Jocco</a>, a Docco
port for the <a href="http://julialang.org/">Julia</a> language. Jocco uses external
tools for syntax highlighting and Markdown rendering, but we opt for
existing R-packages to handle these tasks.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre></pre></div>
          </td>
        </tr>
        <tr id="section-10">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-10">&#182;</a>
            </div>
            <p>Presently, RDocco supports <a href="http://mathjax.com/">MathJax</a> rendering of
&#92;(&#92;LaTeX&#92;) math equations using the delimiters <code>&#92;(...&#92;)</code> (no spaces!) for
inline math (e.g., &#92;(a^2 + b^2 = c^2&#92;)) equations and <code>&#92;[ ... &#92;]</code> for block
equations: &#92;[ &#92;left( &#92;sum_{k=1}^n a_k b_k &#92;right)^2 &#92;leq &#92;left( &#92;sum_{k=1}^n
a_k^2 &#92;right) &#92;left( &#92;sum_{k=1}^n b_k^2 &#92;right) &#92;] Which is a desirable
feature because R is a programming language for statistics!</p>

          </td>
          <td class="code">
            <div class="highlight"><pre></pre></div>
          </td>
        </tr>
        <tr id="section-11">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-11">&#182;</a>
            </div>
            <h2>Actual Code Comments</h2>

<h4>Load supporting packages.</h4>

<ul>
<li><a href="http://cran.r-project.org/web/packages/stringr/">stringr</a> does the heavy
lifting for string-processing.</li>
<li><a href="http://cran.r-project.org/web/packages/highlight/">highlight</a> performs
syntax highlighting on code chunks.</li>
<li><a href="http://cran.r-project.org/web/packages/markdown/">markdown</a> converts
Markdown-formatted comments into HTML.</li>
</ul>

          </td>
          <td class="code">
            <div class="highlight"><pre><span class="functioncall">library</span><span class="keyword">(</span><span class="string">"stringr"</span><span class="keyword">)</span><br/><span class="functioncall">library</span><span class="keyword">(</span><span class="string">"highlight"</span><span class="keyword">)</span><br/><span class="functioncall">library</span><span class="keyword">(</span><span class="string">"markdown"</span><span class="keyword">)</span><br/><span class="functioncall">options</span><span class="keyword">(</span><span class="argument">markdown.HTML.options</span> <span class="argument">=</span> <span class="functioncall">c</span><span class="keyword">(</span><span class="string">'fragment_only'</span><span class="keyword">,</span> <span class="string">'smartypants'</span><span class="keyword">)</span><span class="keyword">)</span></pre></div>
          </td>
        </tr>
        <tr id="section-12">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-12">&#182;</a>
            </div>
            <h4>Initialize HTML templates</h4>

<p>The basic HTML structure of the output document is a 2&ndash;column table where
each row consists of a comment-code pairing. These three string constants
make an HTML sandwich. <code>.HEADER</code> and <code>.FOOTER</code> are the slices of bread and
establish the start and end of the table. <code>.TABLE_ENTRY</code> provides the template
for the sandwich fillings&mdash;i.e., the rows of the table.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre><span class="symbol">.HEADER</span> <span class="assignement">&lt;-</span> <span class="string">[6081 chars quoted with '"']</span><br/><span class="symbol">.TABLE_ENTRY</span> <span class="assignement">&lt;-</span> <span class="string">"<br/>        &lt;tr id=\\"section-%index%\\"&gt;<br/>          &lt;td class=\\"docs\\"&gt;<br/>            &lt;div class=\\"pilwrap\\"&gt;<br/>              &lt;a class=\\"pilcrow\\" href=\\"#section-%index%\\"&gt;&amp;#182;&lt;/a&gt;<br/>            &lt;/div&gt;<br/>            %docs_html%<br/>          &lt;/td&gt;<br/>          &lt;td class=\\"code\\"&gt;<br/>            &lt;div class=\\"highlight\\"&gt;&lt;pre&gt;%code_html%&lt;/pre&gt;&lt;/div&gt;<br/>          &lt;/td&gt;<br/>        &lt;/tr&gt;"</span><br/><span class="symbol">.FOOTER</span> <span class="assignement">&lt;-</span> <span class="string">"<br/>      &lt;/tbody&gt;<br/>    &lt;/table&gt;<br/>  &lt;/div&gt;<br/>&lt;/body&gt;&lt;/html&gt;"</span></pre></div>
          </td>
        </tr>
        <tr id="section-13">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-13">&#182;</a>
            </div>
            <h3>Extract comments and code chunks from a .R file</h3>

<table><thead>
<tr>
<th>Parameters</th>
<th></th>
</tr>
</thead><tbody>
<tr>
<td><code>src</code></td>
<td>a character string specifying the path to the .R file we want to process</td>
</tr>
</tbody></table>

<table><thead>
<tr>
<th>Returns</th>
<th></th>
</tr>
</thead><tbody>
<tr>
<td></td>
<td>a list of 3 character vectors containing the chunks of code, chunks of plain comments, and chunks of Roxygen-style comments.</td>
</tr>
</tbody></table>

          </td>
          <td class="code">
            <div class="highlight"><pre><span class="symbol">.ParseSource</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">src</span><span class="keyword">)</span> <span class="keyword">{</span></pre></div>
          </td>
        </tr>
        <tr id="section-14">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-14">&#182;</a>
            </div>
            <p>Read in the lines of the input script and initalize values.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">lines</span> <span class="assignement">&lt;-</span> <span class="functioncall">readLines</span><span class="keyword">(</span><span class="symbol">src</span><span class="keyword">)</span><br/>  <span class="symbol">code</span> <span class="assignement">&lt;-</span> <span class="functioncall">character</span><span class="keyword">(</span><span class="keyword">)</span><br/>  <span class="symbol">docs</span> <span class="assignement">&lt;-</span> <span class="functioncall">character</span><span class="keyword">(</span><span class="keyword">)</span><br/>  <span class="symbol">has_code</span> <span class="assignement">&lt;-</span> <span class="number">FALSE</span><br/>  <span class="symbol">code_text</span> <span class="assignement">&lt;-</span> <span class="string">""</span><br/>  <span class="symbol">docs_text</span> <span class="assignement">&lt;-</span> <span class="string">""</span></pre></div>
          </td>
        </tr>
        <tr id="section-15">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-15">&#182;</a>
            </div>
            <p><em>Regular expression for matching comments</em></p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">rx_COMMENT</span> <span class="assignement">&lt;-</span> <span class="functioncall">perl</span><span class="keyword">(</span><span class="string">"^\\\\s*(?:(#)+(')?(\\\\s.*)?\\\\s*$)"</span><span class="keyword">)</span></pre></div>
          </td>
        </tr>
        <tr id="section-16">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-16">&#182;</a>
            </div>
            <p>Search for a comment match on each line of the input file. <code>has_code</code>
records whether the last line that was scanned contained code-like text. As
long as <code>has_code</code> doesn&#39;t change, we lump successive lines together into
<code>code_text</code> or <code>docs_text</code>. Those lumped-together get written onto <code>code</code> or
<code>docs</code> once <code>has_code</code> changes.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="keyword">for</span> <span class="keyword">(</span><span class="symbol">line</span> <span class="keyword">in</span> <span class="symbol">lines</span><span class="keyword">)</span> <span class="keyword">{</span></pre></div>
          </td>
        </tr>
        <tr id="section-17">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-17">&#182;</a>
            </div>
            <p>Extract lines that match the comment pattern.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>    <span class="symbol">match</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_extract_all</span><span class="keyword">(</span><span class="symbol">line</span><span class="keyword">,</span> <span class="symbol">rx_COMMENT</span><span class="keyword">)</span><br/>    <span class="symbol">match</span> <span class="assignement">&lt;-</span> <span class="functioncall">unlist</span><span class="keyword">(</span><span class="symbol">match</span><span class="keyword">)</span></pre></div>
          </td>
        </tr>
        <tr id="section-18">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-18">&#182;</a>
            </div>
            <p>If the line only matches an empty string, set it to an empty character
vector.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>    <span class="keyword">if</span> <span class="keyword">(</span><span class="functioncall">length</span><span class="keyword">(</span><span class="symbol">match</span><span class="keyword">)</span> <span class="keyword">&gt;</span> <span class="number">0</span> <span class="keyword">&amp;&amp;</span> <span class="symbol">match</span> == <span class="string">""</span><span class="keyword">)</span> <span class="keyword">{</span><br/>      <span class="symbol">match</span> <span class="assignement">&lt;-</span> <span class="functioncall">character</span><span class="keyword">(</span><span class="keyword">)</span><br/>    <span class="keyword">}</span></pre></div>
          </td>
        </tr>
        <tr id="section-19">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-19">&#182;</a>
            </div>
            <p>If there are no matches, then there is code-like text here. Store the line
as code text.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>    <span class="keyword">if</span> <span class="keyword">(</span><span class="functioncall">length</span><span class="keyword">(</span><span class="symbol">match</span><span class="keyword">)</span> == <span class="number">0</span><span class="keyword">)</span> <span class="keyword">{</span><br/>      <span class="symbol">has_code</span> <span class="assignement">&lt;-</span> <span class="number">TRUE</span><br/>      <span class="symbol">code_text</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_c</span><span class="keyword">(</span><span class="symbol">code_text</span><span class="keyword">,</span> <span class="symbol">line</span><span class="keyword">,</span> <span class="string">"\\n"</span><span class="keyword">)</span><br/>    <span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">{</span></pre></div>
          </td>
        </tr>
        <tr id="section-20">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-20">&#182;</a>
            </div>
            <p>Otherwise, if there is a match to the comment pattern, <em>and</em> the
previous line contained code, update the code texts and reset
initialization values.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>      <span class="keyword">if</span> <span class="keyword">(</span><span class="symbol">has_code</span><span class="keyword">)</span> <span class="keyword">{</span><br/>        <span class="symbol">code</span> <span class="assignement">&lt;-</span> <span class="functioncall">c</span><span class="keyword">(</span><span class="symbol">code</span><span class="keyword">,</span> <span class="symbol">code_text</span><span class="keyword">)</span><br/>        <span class="symbol">docs</span> <span class="assignement">&lt;-</span> <span class="functioncall">c</span><span class="keyword">(</span><span class="symbol">docs</span><span class="keyword">,</span> <span class="symbol">docs_text</span><span class="keyword">)</span><br/>        <span class="symbol">has_code</span> <span class="assignement">&lt;-</span> <span class="number">FALSE</span><br/>        <span class="symbol">code_text</span> <span class="assignement">&lt;-</span> <span class="string">""</span><br/>        <span class="symbol">docs_text</span> <span class="assignement">&lt;-</span> <span class="string">""</span><br/>      <span class="keyword">}</span></pre></div>
          </td>
        </tr>
        <tr id="section-21">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-21">&#182;</a>
            </div>
            <p>Update the documentation with the current line.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>      <span class="symbol">doc_line</span> <span class="assignement">&lt;-</span> <span class="symbol">match</span><br/>      <span class="symbol">docs_text</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_c</span><span class="keyword">(</span><span class="symbol">docs_text</span><span class="keyword">,</span> <span class="symbol">doc_line</span><span class="keyword">,</span> <span class="string">"\\n"</span><span class="keyword">)</span><br/>    <span class="keyword">}</span><br/>  <span class="keyword">}</span></pre></div>
          </td>
        </tr>
        <tr id="section-22">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-22">&#182;</a>
            </div>
            <p>Append the final code and documentation chunks to their text vectors. Trim
off any whitespace from the documentation strings, but keep it in the code
(for syntax indentation).</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">code</span> <span class="assignement">&lt;-</span> <span class="functioncall">c</span><span class="keyword">(</span><span class="symbol">code</span><span class="keyword">,</span> <span class="symbol">code_text</span><span class="keyword">)</span><br/>  <span class="symbol">docs</span> <span class="assignement">&lt;-</span> <span class="functioncall">c</span><span class="keyword">(</span><span class="symbol">docs</span><span class="keyword">,</span> <span class="symbol">docs_text</span><span class="keyword">)</span><br/>  <span class="symbol">docs</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_trim</span><span class="keyword">(</span><span class="symbol">docs</span><span class="keyword">)</span></pre></div>
          </td>
        </tr>
        <tr id="section-23">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-23">&#182;</a>
            </div>
            <p>Replace pairs of empty lines in the code with a single empty line.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">rx_TWO_RETURNS</span> <span class="assignement">&lt;-</span> <span class="functioncall">perl</span><span class="keyword">(</span><span class="string">"\\\\n\\\\s*\\\\n"</span><span class="keyword">)</span><br/>  <span class="symbol">code</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_replace_all</span><span class="keyword">(</span><span class="symbol">code</span><span class="keyword">,</span> <span class="symbol">rx_TWO_RETURNS</span><span class="keyword">,</span> <span class="string">"\\n"</span><span class="keyword">)</span></pre></div>
          </td>
        </tr>
        <tr id="section-24">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-24">&#182;</a>
            </div>
            <p>Roxygen comments are a special kind of comment that start with <code>#&#39;</code>. These
get their own special formatting, so we isolate them from our set of doc
strings.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">rx_ROXYGEN</span> <span class="assignement">&lt;-</span> <span class="functioncall">perl</span><span class="keyword">(</span><span class="string">"^(\\\\s*(#')+\\\\s*(.)*)+"</span><span class="keyword">)</span><br/>  <span class="symbol">rdocs</span> <span class="assignement">&lt;-</span> <span class="symbol">docs</span><br/>  <span class="symbol">rdoc_lines</span> <span class="assignement">&lt;-</span> <span class="functioncall">which</span><span class="keyword">(</span><span class="functioncall">str_detect</span><span class="keyword">(</span><span class="symbol">docs</span><span class="keyword">,</span> <span class="symbol">rx_ROXYGEN</span><span class="keyword">)</span><span class="keyword">)</span><br/>  <span class="symbol">docs</span><span class="keyword">[</span><span class="symbol">rdoc_lines</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <span class="string">""</span><br/>  <span class="symbol">rdocs</span><span class="keyword">[</span><span class="keyword">-</span><span class="symbol">rdoc_lines</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <span class="string">""</span></pre></div>
          </td>
        </tr>
        <tr id="section-25">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-25">&#182;</a>
            </div>
            <p>Remove <code>#</code> characters from our documentation strings and return three equal-
length vectors containing the code lines, plain doc lines and the
Roxygen-style doc lines.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">rx_INITIAL</span> <span class="assignement">&lt;-</span> <span class="functioncall">perl</span><span class="keyword">(</span><span class="string">"^\\\\s*#\\\\s+"</span><span class="keyword">)</span><br/>  <span class="symbol">rx_NEWLINE</span> <span class="assignement">&lt;-</span> <span class="functioncall">perl</span><span class="keyword">(</span><span class="string">"\\\\s*\\\\n\\\\s*#\\\\s*"</span><span class="keyword">)</span><br/>  <span class="symbol">docs</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_replace_all</span><span class="keyword">(</span><span class="symbol">docs</span><span class="keyword">,</span> <span class="symbol">rx_INITIAL</span><span class="keyword">,</span> <span class="string">""</span><span class="keyword">)</span><br/>  <span class="symbol">docs</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_replace_all</span><span class="keyword">(</span><span class="symbol">docs</span><span class="keyword">,</span> <span class="symbol">rx_NEWLINE</span><span class="keyword">,</span> <span class="string">"\\n"</span><span class="keyword">)</span><br/>  <span class="symbol">parsed</span> <span class="assignement">&lt;-</span> <span class="functioncall">list</span><span class="keyword">(</span><span class="argument">code</span> <span class="argument">=</span> <span class="symbol">code</span><span class="keyword">,</span> <span class="argument">docs</span> <span class="argument">=</span> <span class="symbol">docs</span><span class="keyword">,</span> <span class="argument">rdocs</span> <span class="argument">=</span> <span class="symbol">rdocs</span><span class="keyword">)</span><br/>  <span class="functioncall">return</span><span class="keyword">(</span><span class="symbol">parsed</span><span class="keyword">)</span><br/><span class="keyword">}</span></pre></div>
          </td>
        </tr>
        <tr id="section-26">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-26">&#182;</a>
            </div>
            <h3>Highlight R code</h3>

<p>We can only highlight syntactically valid R code, and most of the individual chunks are not valid. If we put all the chunks back together, then we can highlight the R code (assuming the input file contained valid code). In order to break apart the highlighted code, we need to mark each place where we concatenated chunks together and then break up the code at those markers places. We also need to preserve newline characters in strings, so that multi-line strings are not collapsed onto super-long single lines.</p>

<table><thead>
<tr>
<th>Parameters</th>
<th></th>
</tr>
</thead><tbody>
<tr>
<td><code>code_array</code></td>
<td>a character vector containing chunks of un-highlighted R code</td>
</tr>
</tbody></table>

<table><thead>
<tr>
<th>Returns</th>
<th></th>
</tr>
</thead><tbody>
<tr>
<td></td>
<td>a character vector of syntax-highlighted R code in HTML</td>
</tr>
</tbody></table>

          </td>
          <td class="code">
            <div class="highlight"><pre><span class="symbol">.HighlightCode</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">code_array</span><span class="keyword">)</span> <span class="keyword">{</span></pre></div>
          </td>
        </tr>
        <tr id="section-27">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-27">&#182;</a>
            </div>
            <p>Preserve escaped newline characters by marking them.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">sep_part_1</span> <span class="assignement">&lt;-</span> <span class="string">"#%BREAK%"</span><br/>  <span class="symbol">sep_part_2</span> <span class="assignement">&lt;-</span> <span class="string">"#%HERE%"</span><br/>  <span class="symbol">sep</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_c</span><span class="keyword">(</span><span class="symbol">sep_part_1</span><span class="keyword">,</span> <span class="symbol">sep_part_2</span><span class="keyword">)</span><br/>  <span class="symbol">code_array</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_replace_all</span><span class="keyword">(</span><span class="symbol">code_array</span><span class="keyword">,</span> <span class="string">"\\\\n"</span><span class="keyword">,</span> <span class="functioncall">str_c</span><span class="keyword">(</span><span class="symbol">sep</span><span class="keyword">,</span> <span class="string">"\\n"</span><span class="keyword">)</span><span class="keyword">)</span></pre></div>
          </td>
        </tr>
        <tr id="section-28">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-28">&#182;</a>
            </div>
            <p>Combine the chunks of R code together, marking where chunks are concatenated
together.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">code_sep</span> <span class="assignement">&lt;-</span> <span class="string">"# CUT HERE\\n"</span><br/>  <span class="symbol">code_array</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_c</span><span class="keyword">(</span><span class="symbol">code_array</span><span class="keyword">,</span> <span class="argument">collapse</span> <span class="argument">=</span> <span class="symbol">code_sep</span><span class="keyword">)</span></pre></div>
          </td>
        </tr>
        <tr id="section-29">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-29">&#182;</a>
            </div>
            <p>Write the code to a temporary file so it can be syntax-highlighted.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">con</span> <span class="assignement">&lt;-</span> <span class="functioncall">tempfile</span><span class="keyword">(</span><span class="keyword">)</span><br/>  <span class="functioncall">writeLines</span><span class="keyword">(</span><span class="symbol">code_array</span><span class="keyword">,</span> <span class="symbol">con</span><span class="keyword">)</span><br/>  <span class="symbol">code_array</span> <span class="assignement">&lt;-</span> <span class="functioncall">capture.output</span><span class="keyword">(</span><span class="keyword">{</span><br/>    <span class="functioncall">highlight</span><span class="keyword">(</span><span class="symbol">con</span><span class="keyword">,</span> <span class="argument">renderer</span> <span class="argument">=</span> <span class="functioncall">renderer_html</span><span class="keyword">(</span><span class="argument">document</span> <span class="argument">=</span> <span class="number">FALSE</span><span class="keyword">,</span><br/>                                            <span class="argument">header</span> <span class="argument">=</span> <span class="keyword">function</span><span class="keyword">(</span><span class="keyword">)</span> <span class="string">''</span><span class="keyword">,</span><br/>                                            <span class="argument">footer</span> <span class="argument">=</span> <span class="keyword">function</span><span class="keyword">(</span><span class="keyword">)</span> <span class="string">''</span><span class="keyword">)</span><span class="keyword">,</span><br/>              <span class="argument">encoding</span> <span class="argument">=</span> <span class="string">"unknown"</span><span class="keyword">)</span><br/>  <span class="keyword">}</span><span class="keyword">)</span><br/>  <span class="symbol">code_array</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_c</span><span class="keyword">(</span><span class="symbol">code_array</span><span class="keyword">,</span> <span class="argument">collapse</span> <span class="argument">=</span> <span class="string">""</span><span class="keyword">)</span></pre></div>
          </td>
        </tr>
        <tr id="section-30">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-30">&#182;</a>
            </div>
            <p>Split the code at the newline-preserving markers and the chunk-concatenating
markers.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">sep_in_comment</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_c</span><span class="keyword">(</span><span class="string">"&lt;span class=\\"comment\\"&gt;"</span><span class="keyword">,</span> <span class="symbol">sep</span><span class="keyword">,</span> <span class="string">"&lt;/span&gt;"</span><span class="keyword">)</span><br/>  <span class="symbol">code_array</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_replace_all</span><span class="keyword">(</span><span class="symbol">code_array</span><span class="keyword">,</span> <span class="symbol">sep_in_comment</span><span class="keyword">,</span> <span class="string">"&lt;br/&gt;"</span><span class="keyword">)</span><br/>  <span class="symbol">code_array</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_replace_all</span><span class="keyword">(</span><span class="symbol">code_array</span><span class="keyword">,</span> <span class="symbol">sep</span><span class="keyword">,</span> <span class="string">"&lt;br/&gt;"</span><span class="keyword">)</span><br/>  <span class="symbol">code_sep_html</span> <span class="assignement">&lt;-</span> <span class="string">"&lt;span class=\\"comment\\"&gt;# CUT HERE&lt;/span&gt;"</span><br/>  <span class="symbol">code_array</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_split</span><span class="keyword">(</span><span class="symbol">code_array</span><span class="keyword">,</span> <span class="symbol">code_sep_html</span><span class="keyword">)</span><br/>  <span class="symbol">code_array</span> <span class="assignement">&lt;-</span> <span class="functioncall">unlist</span><span class="keyword">(</span><span class="symbol">code_array</span><span class="keyword">)</span><br/>  <span class="functioncall">return</span><span class="keyword">(</span><span class="symbol">code_array</span><span class="keyword">)</span><br/><span class="keyword">}</span></pre></div>
          </td>
        </tr>
        <tr id="section-31">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-31">&#182;</a>
            </div>
            <h3>Parse a Roxygen comment</h3>

<p>This function parses a Roxygen comment and extracts the first line of the comment, any introductory text, and the names and values of any @-tags in the comment. The parsing function below was adapted from <a href="https://github.com/yihui/roxygen2/blob/master/R/parse-preref.R">the parsing function in Roxygen2</a>.</p>

<h4>About Roxygen</h4>

<p>Documentation for R packages takes place in special <code>.Rd</code> files. This organization is problematic because the doc is stored in a separate file from the code it describes, so it takes extra work to keep documentation up to date. The package <a href="https://github.com/yihui/roxygen2">Roxygen2</a> rectifies this problem by automatically generating those docs from specially formatted <em>in-source</em> comments. A Roxygen comment sits above the the function it describes, is set off with special <code></code> comment marks, and information about the function is described with tags like <code>@params</code> or <code>@author</code>. (Read more about R documentation in <a href="https://github.com/hadley/devtools/wiki/docs-function">this Wiki entry</a> from the devtools package.). Roxygen2 then transforms these comments into <code>.Rd</code> files.</p>

<p>Roxygen-style comments seem like a pretty good practice for R coding, because they succinctly describe pertinent information about functions in a structured way. They are also supported by <a href="http://rstudio.org/">RStudio</a>.</p>

<table><thead>
<tr>
<th>Parameters</th>
<th></th>
</tr>
</thead><tbody>
<tr>
<td><code>lines</code></td>
<td>chunks of text that may contain Roxygen-style comments</td>
</tr>
</tbody></table>

<table><thead>
<tr>
<th>Returns</th>
<th></th>
</tr>
</thead><tbody>
<tr>
<td></td>
<td>a list of Roxygen elements, or an empty list if the input text not contain any Roxygen comments</td>
</tr>
</tbody></table>

          </td>
          <td class="code">
            <div class="highlight"><pre><span class="symbol">.ParseRoxygen</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">lines</span><span class="keyword">)</span> <span class="keyword">{</span></pre></div>
          </td>
        </tr>
        <tr id="section-32">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-32">&#182;</a>
            </div>
            <p>Pattern that distinguishes a Roxygen comment from a normal comment.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">rx_LINE_DELIMITER</span> <span class="assignement">&lt;-</span> <span class="string">'\\\\s*#+\\' ?'</span></pre></div>
          </td>
        </tr>
        <tr id="section-33">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-33">&#182;</a>
            </div>
            <p>Does the string contain no matter beside spaces?</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">.is.null.string</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">string</span><span class="keyword">)</span> <span class="keyword">{</span><br/>    <span class="functioncall">str_length</span><span class="keyword">(</span><span class="functioncall">str_trim</span><span class="keyword">(</span><span class="symbol">string</span><span class="keyword">)</span><span class="keyword">)</span> == <span class="number">0</span><br/>  <span class="keyword">}</span></pre></div>
          </td>
        </tr>
        <tr id="section-34">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-34">&#182;</a>
            </div>
            <p>Grab lines starting with the Roxygen pattern and trim trailing (right-sided)
whitespace</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">delimited_lines</span> <span class="assignement">&lt;-</span> <span class="symbol">lines</span><span class="keyword">[</span><span class="functioncall">str_detect</span><span class="keyword">(</span><span class="symbol">lines</span><span class="keyword">,</span> <span class="symbol">rx_LINE_DELIMITER</span><span class="keyword">)</span><span class="keyword">]</span></pre></div>
          </td>
        </tr>
        <tr id="section-35">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-35">&#182;</a>
            </div>
            <p>Split at line breaks.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">lines</span> <span class="assignement">&lt;-</span> <span class="functioncall">unlist</span><span class="keyword">(</span><span class="functioncall">str_split</span><span class="keyword">(</span><span class="symbol">delimited_lines</span><span class="keyword">,</span> <span class="symbol">rx_LINE_DELIMITER</span><span class="keyword">)</span><span class="keyword">)</span><br/>  <span class="symbol">trimmed_lines</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_trim</span><span class="keyword">(</span><span class="symbol">lines</span><span class="keyword">,</span> <span class="string">"right"</span><span class="keyword">)</span></pre></div>
          </td>
        </tr>
        <tr id="section-36">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-36">&#182;</a>
            </div>
            <p>Return an empty list if the trimmed lines are empty. Otherwise merge the
lines together.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="keyword">if</span> <span class="keyword">(</span><span class="functioncall">length</span><span class="keyword">(</span><span class="symbol">trimmed_lines</span><span class="keyword">)</span> == <span class="number">0</span><span class="keyword">)</span> <span class="functioncall">return</span><span class="keyword">(</span><span class="functioncall">list</span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><br/>  <span class="symbol">joined_lines</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_c</span><span class="keyword">(</span><span class="symbol">trimmed_lines</span><span class="keyword">,</span> <span class="argument">collapse</span> <span class="argument">=</span> <span class="string">'\\n'</span><span class="keyword">)</span></pre></div>
          </td>
        </tr>
        <tr id="section-37">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-37">&#182;</a>
            </div>
            <p>Split the Roxygen comment into @-labels chunks</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">elements</span> <span class="assignement">&lt;-</span> <span class="functioncall">strsplit</span><span class="keyword">(</span><span class="symbol">joined_lines</span><span class="keyword">,</span> <span class="string">'(?&lt;!@)@(?!@)'</span><span class="keyword">,</span> <span class="argument">perl</span> <span class="argument">=</span> <span class="number">TRUE</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><br/>  <span class="symbol">elements</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_replace_all</span><span class="keyword">(</span><span class="symbol">elements</span><span class="keyword">,</span> <span class="functioncall">fixed</span><span class="keyword">(</span><span class="string">"@@"</span><span class="keyword">)</span><span class="keyword">,</span> <span class="string">"@"</span><span class="keyword">)</span></pre></div>
          </td>
        </tr>
        <tr id="section-38">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-38">&#182;</a>
            </div>
            <p>Parse the first line of a Roxygen comment block and any text that follows</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">.ParseIntro</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">expression</span><span class="keyword">)</span> <span class="keyword">{</span><br/>    <span class="keyword">if</span> <span class="keyword">(</span><span class="functioncall">.is.null.string</span><span class="keyword">(</span><span class="symbol">expression</span><span class="keyword">)</span><span class="keyword">)</span> <span class="functioncall">return</span><span class="keyword">(</span>NULL<span class="keyword">)</span><br/>    <span class="symbol">intro</span> <span class="assignement">&lt;-</span> <span class="functioncall">unlist</span><span class="keyword">(</span><span class="functioncall">str_trim</span><span class="keyword">(</span><span class="symbol">expression</span><span class="keyword">)</span><span class="keyword">)</span><br/>    <span class="symbol">intro</span> <span class="assignement">&lt;-</span> <span class="functioncall">unlist</span><span class="keyword">(</span><span class="functioncall">str_split</span><span class="keyword">(</span><span class="symbol">intro</span><span class="keyword">,</span> <span class="string">"\\n\\\\s*\\n"</span><span class="keyword">)</span><span class="keyword">)</span><br/>    <span class="symbol">parts</span> <span class="assignement">&lt;-</span> <span class="functioncall">list</span><span class="keyword">(</span><span class="argument">first_line</span> <span class="argument">=</span> <span class="symbol">intro</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">introduction</span> <span class="argument">=</span> <span class="symbol">intro</span><span class="keyword">[</span><span class="keyword">-</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">)</span><br/>    <span class="functioncall">return</span><span class="keyword">(</span><span class="symbol">parts</span><span class="keyword">)</span><br/>  <span class="keyword">}</span><br/>  <span class="symbol">parsed_introduction</span> <span class="assignement">&lt;-</span> <span class="functioncall">.ParseIntro</span><span class="keyword">(</span><span class="symbol">elements</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">)</span></pre></div>
          </td>
        </tr>
        <tr id="section-39">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-39">&#182;</a>
            </div>
            <p>Parse <code>@tag value</code> items</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">.ParseElement</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">element</span><span class="keyword">)</span> <span class="keyword">{</span><br/>    <span class="symbol">pieces</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_split_fixed</span><span class="keyword">(</span><span class="symbol">element</span><span class="keyword">,</span> <span class="string">"[[:space:]]+"</span><span class="keyword">,</span> <span class="number">2</span><span class="keyword">)</span><br/>    <span class="symbol">tag</span> <span class="assignement">&lt;-</span> <span class="symbol">pieces</span><span class="keyword">[</span><span class="keyword">,</span> <span class="number">1</span><span class="keyword">]</span><br/>    <span class="symbol">rest</span> <span class="assignement">&lt;-</span> <span class="symbol">pieces</span><span class="keyword">[</span><span class="keyword">,</span> <span class="number">2</span><span class="keyword">]</span><br/>    <span class="symbol">rest</span> <span class="assignement">&lt;-</span> <span class="functioncall">list</span><span class="keyword">(</span><span class="symbol">rest</span><span class="keyword">)</span><br/>    <span class="functioncall">names</span><span class="keyword">(</span><span class="symbol">rest</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <span class="symbol">tag</span><br/>    <span class="functioncall">return</span><span class="keyword">(</span><span class="symbol">rest</span><span class="keyword">)</span><br/>  <span class="keyword">}</span><br/>  <span class="symbol">parsed_elements</span> <span class="assignement">&lt;-</span> <span class="functioncall">unlist</span><span class="keyword">(</span><span class="functioncall">lapply</span><span class="keyword">(</span><span class="symbol">elements</span><span class="keyword">[</span><span class="keyword">-</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">,</span> <span class="symbol">.ParseElement</span><span class="keyword">)</span><span class="keyword">,</span><br/>                            <span class="argument">recursive</span> <span class="argument">=</span> <span class="number">FALSE</span><span class="keyword">)</span><br/>  <span class="functioncall">return</span><span class="keyword">(</span><span class="functioncall">c</span><span class="keyword">(</span><span class="symbol">parsed_introduction</span><span class="keyword">,</span> <span class="symbol">parsed_elements</span><span class="keyword">)</span><span class="keyword">)</span><br/><span class="keyword">}</span></pre></div>
          </td>
        </tr>
        <tr id="section-40">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-40">&#182;</a>
            </div>
            <h3>Insert Roxygen-style comments into Markdown templates</h3>

<p>RDocco applies Markdown formatting to the content of a Roxygen comment. Specifically, the first line of a Roxygen block is formatted as an <code>&lt;h3&gt;</code> element. The following Roxygen <code>@</code>-tags are then formatted, if present: <code>@param</code> tags are combined and output as a table, <code>@return</code> is output as a table (assuming there is only one <code>@return</code> tag), and <code>@TODO</code> tags (which I invented) are combined and output as an unordered list.</p>

<p><strong>Note:</strong> In order to write those @-signs in this Roxygen comment, I had to double up on them as an escape: <code>@@</code> renders as  &ldquo;@&rdquo;.</p>

<p><strong>TODO</strong></p>

<ul>
<li>Make Markdown lists work in the Roxygen comments</li>
<li>Generate template for <code>@note</code> tags.</li>
<li>Generate template for <code>@examples</code> tags.</li>
</ul>

<table><thead>
<tr>
<th>Parameters</th>
<th></th>
</tr>
</thead><tbody>
<tr>
<td><code>roxy_lines</code></td>
<td>a <code>list</code> of Roxygen comments. The names of the list element tell us what kind of Roxygen comment each element is.</td>
</tr>
</tbody></table>

<table><thead>
<tr>
<th>Returns</th>
<th></th>
</tr>
</thead><tbody>
<tr>
<td></td>
<td>a Markdown-formatted string of the input Roxygen-style comments, or an empty string on empty input</td>
</tr>
</tbody></table>

          </td>
          <td class="code">
            <div class="highlight"><pre><span class="symbol">.DressUpRoxy</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">roxy_lines</span><span class="keyword">)</span> <span class="keyword">{</span><br/>  <span class="keyword">if</span> <span class="keyword">(</span><span class="functioncall">length</span><span class="keyword">(</span><span class="symbol">roxy_lines</span><span class="keyword">)</span> == <span class="number">0</span><span class="keyword">)</span> <span class="keyword">{</span><br/>    <span class="functioncall">return</span><span class="keyword">(</span><span class="string">""</span><span class="keyword">)</span><br/>  <span class="keyword">}</span></pre></div>
          </td>
        </tr>
        <tr id="section-41">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-41">&#182;</a>
            </div>
            <p><em>Support function for cleaning up Roxygen lines before formatting them</em></p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">.FetchLines</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">line</span><span class="keyword">)</span> <span class="keyword">{</span><br/>    <span class="symbol">line</span> <span class="assignement">&lt;-</span> <span class="functioncall">unlist</span><span class="keyword">(</span><span class="symbol">line</span><span class="keyword">,</span> <span class="argument">use.names</span> <span class="argument">=</span> <span class="number">FALSE</span><span class="keyword">)</span></pre></div>
          </td>
        </tr>
        <tr id="section-42">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-42">&#182;</a>
            </div>
            <p>Remove line breaks</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>    <span class="symbol">line</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_replace_all</span><span class="keyword">(</span><span class="symbol">line</span><span class="keyword">,</span> <span class="string">"\\\\s*\\\\n\\\\s*"</span><span class="keyword">,</span> <span class="string">" "</span><span class="keyword">)</span><br/>    <span class="symbol">line</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_trim</span><span class="keyword">(</span><span class="symbol">line</span><span class="keyword">)</span><br/>    <span class="functioncall">return</span><span class="keyword">(</span><span class="symbol">line</span><span class="keyword">)</span><br/>  <span class="keyword">}</span></pre></div>
          </td>
        </tr>
        <tr id="section-43">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-43">&#182;</a>
            </div>
            <p>Determine what kind of Roxygen comment each line is. Then start processing
lines by extracting and combining <code>@param</code> lines into a table.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">line_class</span> <span class="assignement">&lt;-</span> <span class="functioncall">unlist</span><span class="keyword">(</span><span class="functioncall">attributes</span><span class="keyword">(</span><span class="symbol">roxy_lines</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">use.names</span> <span class="argument">=</span> <span class="number">FALSE</span><span class="keyword">)</span><br/>  <span class="symbol">param_lines</span> <span class="assignement">&lt;-</span> <span class="functioncall">which</span><span class="keyword">(</span><span class="functioncall">str_detect</span><span class="keyword">(</span><span class="symbol">line_class</span><span class="keyword">,</span> <span class="string">"param"</span><span class="keyword">)</span><span class="keyword">)</span><br/>  <span class="keyword">if</span> <span class="keyword">(</span><span class="functioncall">length</span><span class="keyword">(</span><span class="symbol">param_lines</span><span class="keyword">)</span> <span class="keyword">&gt;</span> <span class="number">0</span><span class="keyword">)</span> <span class="keyword">{</span><br/>    <span class="symbol">table_header</span> <span class="assignement">&lt;-</span> <span class="string">"|Parameters |      |\\n|------|------|"</span><br/>    <span class="symbol">params</span> <span class="assignement">&lt;-</span> <span class="functioncall">.FetchLines</span><span class="keyword">(</span><span class="symbol">roxy_lines</span><span class="keyword">[</span><span class="symbol">param_lines</span><span class="keyword">]</span><span class="keyword">)</span><br/>    <span class="symbol">params</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_replace</span><span class="keyword">(</span><span class="symbol">params</span><span class="keyword">,</span> <span class="string">"^\\\\s*(\\\\S+)\\\\s+(.*)"</span><span class="keyword">,</span> <span class="string">"| `\\\\1` | \\\\2 |"</span><span class="keyword">)</span><br/>    <span class="symbol">params</span> <span class="assignement">&lt;-</span> <span class="functioncall">c</span><span class="keyword">(</span><span class="symbol">table_header</span><span class="keyword">,</span> <span class="symbol">params</span><span class="keyword">)</span><br/>    <span class="symbol">params</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_c</span><span class="keyword">(</span><span class="symbol">params</span><span class="keyword">,</span> <span class="argument">collapse</span> <span class="argument">=</span> <span class="string">"\\n"</span><span class="keyword">)</span><br/>    <span class="symbol">params</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_c</span><span class="keyword">(</span><span class="symbol">params</span><span class="keyword">,</span> <span class="string">"\\n"</span><span class="keyword">)</span></pre></div>
          </td>
        </tr>
        <tr id="section-44">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-44">&#182;</a>
            </div>
            <p>Since we are combining elements into one <code>@param</code> table, we remove all
<code>@param</code> lines beyond the first.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>    <span class="symbol">roxy_lines</span><span class="keyword">[</span><span class="symbol">param_lines</span><span class="keyword">[</span><span class="keyword">-</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> NULL<br/>    <span class="symbol">roxy_lines</span><span class="keyword">$</span><span class="symbol">param</span> <span class="assignement">&lt;-</span> <span class="symbol">params</span><br/>  <span class="keyword">}</span></pre></div>
          </td>
        </tr>
        <tr id="section-45">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-45">&#182;</a>
            </div>
            <p>Extract <code>@return</code> element&mdash;there should be at most one&mdash;and insert it into
a table.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">line_class</span> <span class="assignement">&lt;-</span> <span class="functioncall">unlist</span><span class="keyword">(</span><span class="functioncall">attributes</span><span class="keyword">(</span><span class="symbol">roxy_lines</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">use.names</span> <span class="argument">=</span> <span class="number">FALSE</span><span class="keyword">)</span><br/>  <span class="symbol">return_lines</span> <span class="assignement">&lt;-</span> <span class="functioncall">which</span><span class="keyword">(</span><span class="functioncall">str_detect</span><span class="keyword">(</span><span class="symbol">line_class</span><span class="keyword">,</span> <span class="string">"return"</span><span class="keyword">)</span><span class="keyword">)</span><br/>  <span class="keyword">if</span> <span class="keyword">(</span><span class="functioncall">length</span><span class="keyword">(</span><span class="symbol">return_lines</span><span class="keyword">)</span> <span class="keyword">&gt;</span> <span class="number">0</span><span class="keyword">)</span> <span class="keyword">{</span><br/>    <span class="symbol">table_header</span> <span class="assignement">&lt;-</span> <span class="string">"| Returns |      |\\n|------|------|"</span><br/>    <span class="symbol">returns</span> <span class="assignement">&lt;-</span> <span class="functioncall">.FetchLines</span><span class="keyword">(</span><span class="symbol">roxy_lines</span><span class="keyword">[</span><span class="symbol">return_lines</span><span class="keyword">]</span><span class="keyword">)</span><br/>    <span class="symbol">returns</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_c</span><span class="keyword">(</span><span class="string">"| | "</span><span class="keyword">,</span> <span class="symbol">returns</span><span class="keyword">,</span> <span class="string">" |"</span><span class="keyword">)</span><br/>    <span class="symbol">returns</span> <span class="assignement">&lt;-</span> <span class="functioncall">c</span><span class="keyword">(</span><span class="symbol">table_header</span><span class="keyword">,</span> <span class="symbol">returns</span><span class="keyword">)</span><br/>    <span class="symbol">returns</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_c</span><span class="keyword">(</span><span class="symbol">returns</span><span class="keyword">,</span> <span class="argument">collapse</span> <span class="argument">=</span> <span class="string">"\\n"</span><span class="keyword">)</span><br/>    <span class="symbol">returns</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_c</span><span class="keyword">(</span><span class="symbol">returns</span><span class="keyword">,</span> <span class="string">"\\n"</span><span class="keyword">)</span><br/>    <span class="symbol">roxy_lines</span><span class="keyword">$</span><span class="string">"return"</span> <span class="assignement">&lt;-</span> <span class="symbol">returns</span><br/>  <span class="keyword">}</span></pre></div>
          </td>
        </tr>
        <tr id="section-46">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-46">&#182;</a>
            </div>
            <p>The first line of the Roxygen block gets formatted as an <code>&lt;h3&gt;</code>.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">line_class</span> <span class="assignement">&lt;-</span> <span class="functioncall">unlist</span><span class="keyword">(</span><span class="functioncall">attributes</span><span class="keyword">(</span><span class="symbol">roxy_lines</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">use.names</span> <span class="argument">=</span> <span class="number">FALSE</span><span class="keyword">)</span><br/>  <span class="symbol">first_line</span> <span class="assignement">&lt;-</span> <span class="functioncall">which</span><span class="keyword">(</span><span class="functioncall">str_detect</span><span class="keyword">(</span><span class="symbol">line_class</span><span class="keyword">,</span> <span class="string">"first_line"</span><span class="keyword">)</span><span class="keyword">)</span><br/>  <span class="keyword">if</span> <span class="keyword">(</span><span class="functioncall">length</span><span class="keyword">(</span><span class="symbol">first_line</span><span class="keyword">)</span> <span class="keyword">&gt;</span> <span class="number">0</span><span class="keyword">)</span> <span class="keyword">{</span><br/>    <span class="symbol">roxy_lines</span><span class="keyword">$</span><span class="symbol">first_line</span> <span class="assignement">&lt;-</span> <span class="functioncall">.FetchLines</span><span class="keyword">(</span><span class="symbol">roxy_lines</span><span class="keyword">[</span><span class="symbol">first_line</span><span class="keyword">]</span><span class="keyword">)</span><br/>    <span class="symbol">roxy_lines</span><span class="keyword">$</span><span class="symbol">first_line</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_c</span><span class="keyword">(</span><span class="string">"### "</span><span class="keyword">,</span> <span class="symbol">roxy_lines</span><span class="keyword">$</span><span class="symbol">first_line</span><span class="keyword">,</span> <span class="string">"\\n"</span><span class="keyword">)</span><br/>  <span class="keyword">}</span></pre></div>
          </td>
        </tr>
        <tr id="section-47">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-47">&#182;</a>
            </div>
            <p>Extract any <code>@TODO</code> elements and combine them into a list.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">line_class</span> <span class="assignement">&lt;-</span> <span class="functioncall">unlist</span><span class="keyword">(</span><span class="functioncall">attributes</span><span class="keyword">(</span><span class="symbol">roxy_lines</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">use.names</span> <span class="argument">=</span> <span class="number">FALSE</span><span class="keyword">)</span><br/>  <span class="symbol">TODO_lines</span> <span class="assignement">&lt;-</span> <span class="functioncall">which</span><span class="keyword">(</span><span class="functioncall">str_detect</span><span class="keyword">(</span><span class="symbol">line_class</span><span class="keyword">,</span> <span class="string">"TODO"</span><span class="keyword">)</span><span class="keyword">)</span><br/>  <span class="keyword">if</span> <span class="keyword">(</span><span class="functioncall">length</span><span class="keyword">(</span><span class="symbol">TODO_lines</span><span class="keyword">)</span> <span class="keyword">&gt;</span> <span class="number">0</span><span class="keyword">)</span> <span class="keyword">{</span><br/>    <span class="symbol">list_header</span> <span class="assignement">&lt;-</span> <span class="string">"**TODO**\\n"</span><br/>    <span class="symbol">TODOs</span> <span class="assignement">&lt;-</span> <span class="functioncall">.FetchLines</span><span class="keyword">(</span><span class="symbol">roxy_lines</span><span class="keyword">[</span><span class="symbol">TODO_lines</span><span class="keyword">]</span><span class="keyword">)</span><br/>    <span class="symbol">TODOs</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_c</span><span class="keyword">(</span><span class="string">"+ "</span><span class="keyword">,</span> <span class="symbol">TODOs</span><span class="keyword">)</span><br/>    <span class="symbol">TODOs</span> <span class="assignement">&lt;-</span> <span class="functioncall">c</span><span class="keyword">(</span><span class="symbol">list_header</span><span class="keyword">,</span> <span class="symbol">TODOs</span><span class="keyword">)</span><br/>    <span class="symbol">TODOs</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_c</span><span class="keyword">(</span><span class="symbol">TODOs</span><span class="keyword">,</span> <span class="argument">collapse</span> <span class="argument">=</span> <span class="string">"\\n"</span><span class="keyword">)</span><br/>    <span class="symbol">TODOs</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_c</span><span class="keyword">(</span><span class="symbol">TODOs</span><span class="keyword">,</span> <span class="string">"\\n"</span><span class="keyword">)</span></pre></div>
          </td>
        </tr>
        <tr id="section-48">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-48">&#182;</a>
            </div>
            <p>Since we are combining elements into one <code>@TODO</code> list, we remove all
<code>@TODO</code> lines beyond the first.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>    <span class="symbol">roxy_lines</span><span class="keyword">[</span><span class="symbol">TODO_lines</span><span class="keyword">[</span><span class="keyword">-</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> NULL<br/>    <span class="symbol">roxy_lines</span><span class="keyword">$</span><span class="symbol">TODO</span> <span class="assignement">&lt;-</span> <span class="symbol">TODOs</span><br/>  <span class="keyword">}</span></pre></div>
          </td>
        </tr>
        <tr id="section-49">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-49">&#182;</a>
            </div>
            <p>All other Roxygen comments are considered paragraphs of an &ldquo;introduction&rdquo;
text, so these are combined together.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">line_class</span> <span class="assignement">&lt;-</span> <span class="functioncall">unlist</span><span class="keyword">(</span><span class="functioncall">attributes</span><span class="keyword">(</span><span class="symbol">roxy_lines</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">use.names</span> <span class="argument">=</span> <span class="number">FALSE</span><span class="keyword">)</span><br/>  <span class="symbol">introduction</span> <span class="assignement">&lt;-</span> <span class="functioncall">which</span><span class="keyword">(</span><span class="functioncall">str_detect</span><span class="keyword">(</span><span class="symbol">line_class</span><span class="keyword">,</span> <span class="string">"introduction"</span><span class="keyword">)</span><span class="keyword">)</span><br/>  <span class="keyword">if</span> <span class="keyword">(</span><span class="functioncall">length</span><span class="keyword">(</span><span class="symbol">introduction</span><span class="keyword">)</span> <span class="keyword">&gt;</span> <span class="number">0</span><span class="keyword">)</span> <span class="keyword">{</span><br/>    <span class="symbol">intros</span> <span class="assignement">&lt;-</span> <span class="functioncall">.FetchLines</span><span class="keyword">(</span><span class="symbol">roxy_lines</span><span class="keyword">[</span><span class="symbol">introduction</span><span class="keyword">]</span><span class="keyword">)</span><br/>    <span class="symbol">intros</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_c</span><span class="keyword">(</span><span class="symbol">intros</span><span class="keyword">,</span> <span class="argument">collapse</span> <span class="argument">=</span> <span class="string">"\\n\\n"</span><span class="keyword">)</span><br/>    <span class="symbol">intros</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_c</span><span class="keyword">(</span><span class="symbol">intros</span><span class="keyword">,</span> <span class="string">"\\n"</span><span class="keyword">)</span><br/>    <span class="symbol">roxy_lines</span><span class="keyword">$</span><span class="symbol">introduction</span> <span class="assignement">&lt;-</span> <span class="symbol">intros</span><br/>  <span class="keyword">}</span><br/>  <span class="symbol">roxy_lines</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_c</span><span class="keyword">(</span><span class="functioncall">unlist</span><span class="keyword">(</span><span class="symbol">roxy_lines</span><span class="keyword">,</span> <span class="argument">use.names</span> <span class="argument">=</span> <span class="number">FALSE</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">collapse</span> <span class="argument">=</span> <span class="string">"\\n\\n"</span><span class="keyword">)</span><br/>  <span class="functioncall">return</span><span class="keyword">(</span><span class="symbol">roxy_lines</span><span class="keyword">)</span><br/><span class="keyword">}</span></pre></div>
          </td>
        </tr>
        <tr id="section-50">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-50">&#182;</a>
            </div>
            <h3>Convert Markdown-formatted strings into HTML</h3>

<table><thead>
<tr>
<th>Parameters</th>
<th></th>
</tr>
</thead><tbody>
<tr>
<td><code>doc_array</code></td>
<td>a character vector containing Markdown-formatted strings</td>
</tr>
</tbody></table>

<table><thead>
<tr>
<th>Returns</th>
<th></th>
</tr>
</thead><tbody>
<tr>
<td></td>
<td>an HTML-formatted version of the input character vector</td>
</tr>
</tbody></table>

          </td>
          <td class="code">
            <div class="highlight"><pre><span class="symbol">.MarkItDown</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">doc_array</span><span class="keyword">)</span> <span class="keyword">{</span><br/>  <span class="symbol">cust_extensions</span> <span class="assignement">&lt;-</span> <span class="functioncall">c</span><span class="keyword">(</span><span class="string">"no_intra_emphasis"</span><span class="keyword">,</span> <span class="string">"tables"</span><span class="keyword">,</span> <span class="string">"fenced_code"</span><span class="keyword">,</span> <span class="string">"autolink"</span><span class="keyword">,</span><br/>                       <span class="string">"strikethrough"</span><span class="keyword">,</span> <span class="string">"lax_spacing"</span><span class="keyword">,</span> <span class="string">"space_headers"</span><span class="keyword">,</span><br/>                       <span class="string">"latex_math"</span><span class="keyword">)</span><br/>  <span class="keyword">for</span> <span class="keyword">(</span><span class="symbol">line_num</span> <span class="keyword">in</span> <span class="number">1</span><span class="keyword">:</span><span class="functioncall">length</span><span class="keyword">(</span><span class="symbol">doc_array</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">{</span><br/>    <span class="symbol">line</span> <span class="assignement">&lt;-</span> <span class="symbol">doc_array</span><span class="keyword">[</span><span class="symbol">line_num</span><span class="keyword">]</span><br/>    <span class="keyword">if</span> <span class="keyword">(</span><span class="symbol">line</span> <span class="keyword">!=</span> <span class="string">""</span><span class="keyword">)</span> <span class="keyword">{</span><br/>      <span class="symbol">line</span> <span class="assignement">&lt;-</span> <span class="functioncall">markdownToHTML</span><span class="keyword">(</span><span class="argument">text</span> <span class="argument">=</span> <span class="symbol">line</span><span class="keyword">,</span> <span class="argument">extensions</span> <span class="argument">=</span> <span class="symbol">cust_extensions</span><span class="keyword">)</span><br/>    <span class="keyword">}</span><br/>    <span class="symbol">doc_array</span><span class="keyword">[</span><span class="symbol">line_num</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <span class="symbol">line</span><br/>  <span class="keyword">}</span><br/>  <span class="functioncall">return</span><span class="keyword">(</span><span class="symbol">doc_array</span><span class="keyword">)</span><br/><span class="keyword">}</span></pre></div>
          </td>
        </tr>
        <tr id="section-51">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-51">&#182;</a>
            </div>
            <h3>Generate literate documentation from Markdown-formatted comments in an R script</h3>

<p>This is the main formatting function. <code>Doccofy</code> loads the source R script, parses the comments from the code, highlights the code, inserts the contents of Roxygen comments into Markdown templates, combines the processed Roxygen comments with regular comments, converts the Markdown-formatted test into HTML, and then builds the final HTML output file.</p>

<table><thead>
<tr>
<th>Parameters</th>
<th></th>
</tr>
</thead><tbody>
<tr>
<td><code>src</code></td>
<td>the path to the R script</td>
</tr>
</tbody></table>

<table><thead>
<tr>
<th>Returns</th>
<th></th>
</tr>
</thead><tbody>
<tr>
<td></td>
<td>nothing is returned, but a <code>[src].html</code> file is generated in the source file&#39;s directory</td>
</tr>
</tbody></table>

          </td>
          <td class="code">
            <div class="highlight"><pre><span class="symbol">Doccofy</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">src</span><span class="keyword">)</span> <span class="keyword">{</span></pre></div>
          </td>
        </tr>
        <tr id="section-52">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-52">&#182;</a>
            </div>
            <p>Extract title from filepath. Set the title in <code>.HEADER</code> HTML template.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">title</span> <span class="assignement">&lt;-</span> <span class="functioncall">unlist</span><span class="keyword">(</span><span class="functioncall">str_split</span><span class="keyword">(</span><span class="symbol">src</span><span class="keyword">,</span> <span class="string">"/"</span><span class="keyword">)</span><span class="keyword">)</span><br/>  <span class="symbol">title</span> <span class="assignement">&lt;-</span> <span class="symbol">title</span><span class="keyword">[</span><span class="functioncall">length</span><span class="keyword">(</span><span class="symbol">title</span><span class="keyword">)</span><span class="keyword">]</span><br/>  <span class="symbol">header</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_replace_all</span><span class="keyword">(</span><span class="symbol">.HEADER</span><span class="keyword">,</span> <span class="string">"%title%"</span><span class="keyword">,</span> <span class="symbol">title</span><span class="keyword">)</span></pre></div>
          </td>
        </tr>
        <tr id="section-53">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-53">&#182;</a>
            </div>
            <p>Parse the input file into code chunks, plain-comment <code>#</code> chunks and
Roxygen-style <code>#&#39;</code> comment chunks.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">parsed</span> <span class="assignement">&lt;-</span> <span class="functioncall">.ParseSource</span><span class="keyword">(</span><span class="symbol">src</span><span class="keyword">)</span><br/>  <span class="symbol">code</span> <span class="assignement">&lt;-</span> <span class="symbol">parsed</span><span class="keyword">$</span><span class="symbol">code</span><br/>  <span class="symbol">docs</span> <span class="assignement">&lt;-</span> <span class="symbol">parsed</span><span class="keyword">$</span><span class="symbol">docs</span><br/>  <span class="symbol">rdocs</span> <span class="assignement">&lt;-</span> <span class="symbol">parsed</span><span class="keyword">$</span><span class="symbol">rdocs</span></pre></div>
          </td>
        </tr>
        <tr id="section-54">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-54">&#182;</a>
            </div>
            <p>Format documentation text in each set of comments. Merge <code>#</code> and <code>#&#39;</code>
chunks back to together.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">rdocs</span> <span class="assignement">&lt;-</span> <span class="functioncall">Map</span><span class="keyword">(</span><span class="symbol">.ParseRoxygen</span><span class="keyword">,</span> <span class="symbol">rdocs</span><span class="keyword">)</span><br/>  <span class="symbol">rdocs</span> <span class="assignement">&lt;-</span> <span class="functioncall">unlist</span><span class="keyword">(</span><span class="functioncall">Map</span><span class="keyword">(</span><span class="symbol">.DressUpRoxy</span><span class="keyword">,</span> <span class="symbol">rdocs</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">use.names</span> <span class="argument">=</span> <span class="number">FALSE</span><span class="keyword">)</span><br/>  <span class="symbol">rdoc_lines</span> <span class="assignement">&lt;-</span> <span class="functioncall">which</span><span class="keyword">(</span><span class="keyword">!</span><span class="functioncall">str_detect</span><span class="keyword">(</span><span class="symbol">rdocs</span><span class="keyword">,</span> <span class="string">"^$"</span><span class="keyword">)</span><span class="keyword">)</span><br/>  <span class="symbol">docs</span><span class="keyword">[</span><span class="symbol">rdoc_lines</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <span class="symbol">rdocs</span><span class="keyword">[</span><span class="symbol">rdoc_lines</span><span class="keyword">]</span><br/>  <span class="symbol">docs</span> <span class="assignement">&lt;-</span> <span class="functioncall">.MarkItDown</span><span class="keyword">(</span><span class="symbol">docs</span><span class="keyword">)</span></pre></div>
          </td>
        </tr>
        <tr id="section-55">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-55">&#182;</a>
            </div>
            <p>Replace escaped backslashes with HTML entities. This lets us do &#92;(&#92;LaTeX&#92;),
but we might (?) face problems rendering escape characters in our
documentation.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">docs</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_replace_all</span><span class="keyword">(</span><span class="symbol">docs</span><span class="keyword">,</span> <span class="string">"\\\\\\\\"</span><span class="keyword">,</span> <span class="string">"&amp;#92;"</span><span class="keyword">)</span></pre></div>
          </td>
        </tr>
        <tr id="section-56">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-56">&#182;</a>
            </div>
            <p>Highlight code. Remove unnecessary line-breaks at the ends of code chunks.
Preserve escape sequences in strings by doubling up on escape characters.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">code</span> <span class="assignement">&lt;-</span> <span class="functioncall">.HighlightCode</span><span class="keyword">(</span><span class="symbol">code</span><span class="keyword">)</span><br/>  <span class="symbol">code</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_replace_all</span><span class="keyword">(</span><span class="symbol">code</span><span class="keyword">,</span> <span class="string">"&lt;br/&gt;$"</span><span class="keyword">,</span> <span class="string">""</span><span class="keyword">)</span><br/>  <span class="symbol">code</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_replace_all</span><span class="keyword">(</span><span class="symbol">code</span><span class="keyword">,</span> <span class="string">"\\\\\\\\"</span><span class="keyword">,</span> <span class="string">"\\\\\\\\\\\\\\\\"</span><span class="keyword">)</span></pre></div>
          </td>
        </tr>
        <tr id="section-57">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-57">&#182;</a>
            </div>
            <p>An alternative string replacement function that doesn&#39;t use regular
expressions.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">str_replace_gsub</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">string</span><span class="keyword">,</span> <span class="formalargs">pattern</span><span class="keyword">,</span> <span class="formalargs">replacement</span><span class="keyword">)</span> <span class="keyword">{</span><br/>    <span class="functioncall">gsub</span><span class="keyword">(</span><span class="symbol">pattern</span><span class="keyword">,</span> <span class="symbol">replacement</span><span class="keyword">,</span> <span class="symbol">string</span><span class="keyword">,</span> <span class="argument">fixed</span> <span class="argument">=</span> <span class="number">TRUE</span><span class="keyword">)</span><br/>  <span class="keyword">}</span></pre></div>
          </td>
        </tr>
        <tr id="section-58">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-58">&#182;</a>
            </div>
            <p>Plug the formatted documentation and highlighted code chunks together into
our <code>.TABLE_ENTRY</code> HTML template.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">formatted</span> <span class="assignement">&lt;-</span> <span class="functioncall">character</span><span class="keyword">(</span><span class="functioncall">length</span><span class="keyword">(</span><span class="symbol">code</span><span class="keyword">)</span><span class="keyword">)</span><br/>  <span class="keyword">for</span> <span class="keyword">(</span><span class="symbol">chunk_num</span> <span class="keyword">in</span> <span class="number">1</span><span class="keyword">:</span><span class="functioncall">length</span><span class="keyword">(</span><span class="symbol">code</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">{</span><br/>    <span class="symbol">table_row</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_replace_all</span><span class="keyword">(</span><span class="symbol">.TABLE_ENTRY</span><span class="keyword">,</span> <span class="string">"%index%"</span><span class="keyword">,</span> <span class="symbol">chunk_num</span><span class="keyword">)</span><br/>    <span class="symbol">table_row</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_replace_gsub</span><span class="keyword">(</span><span class="symbol">table_row</span><span class="keyword">,</span> <span class="string">"%docs_html%"</span><span class="keyword">,</span> <span class="symbol">docs</span><span class="keyword">[</span><span class="symbol">chunk_num</span><span class="keyword">]</span><span class="keyword">)</span><br/>    <span class="symbol">table_row</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_replace_gsub</span><span class="keyword">(</span><span class="symbol">table_row</span><span class="keyword">,</span> <span class="string">"%code_html%"</span><span class="keyword">,</span> <span class="symbol">code</span><span class="keyword">[</span><span class="symbol">chunk_num</span><span class="keyword">]</span><span class="keyword">)</span><br/>    <span class="symbol">formatted</span><span class="keyword">[</span><span class="symbol">chunk_num</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <span class="symbol">table_row</span><br/>  <span class="keyword">}</span></pre></div>
          </td>
        </tr>
        <tr id="section-59">
          <td class="docs">
            <div class="pilwrap">
              <a class="pilcrow" href="#section-59">&#182;</a>
            </div>
            <p>Put our HTML sandwich together and output the final file.</p>

          </td>
          <td class="code">
            <div class="highlight"><pre>  <span class="symbol">formatted</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_c</span><span class="keyword">(</span><span class="symbol">formatted</span><span class="keyword">,</span> <span class="argument">collapse</span> <span class="argument">=</span> <span class="string">""</span><span class="keyword">)</span><br/>  <span class="symbol">final_html</span> <span class="assignement">&lt;-</span> <span class="functioncall">str_c</span><span class="keyword">(</span><span class="symbol">header</span><span class="keyword">,</span> <span class="symbol">formatted</span><span class="keyword">,</span> <span class="symbol">.FOOTER</span><span class="keyword">,</span> <span class="argument">collapse</span> <span class="argument">=</span> <span class="string">""</span><span class="keyword">)</span><br/>  <span class="functioncall">write</span><span class="keyword">(</span><span class="symbol">final_html</span><span class="keyword">,</span> <span class="functioncall">str_c</span><span class="keyword">(</span><span class="symbol">src</span><span class="keyword">,</span> <span class="string">".html"</span><span class="keyword">)</span><span class="keyword">)</span><br/><span class="keyword">}</span></pre></div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</body></html>
